<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GAMOPOLY SCORER</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>GAMOPOLY SCORER<br>Let's Play!</h1>
  

  <div id="player-section">
    <h2>Add Players!</h2>

    <!-- input section -->
    <div id="add-player-input">
      <input type="text" id="player-name" placeholder="Enter player name">
    </div>

    <!-- button section -->
    <div id="add-player-buttons">
      <button onclick="addPlayer()">Add Player</button>
      <button onclick="deleteAllPlayers()" 
        style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer;">
        Delete All Players
      </button>
    </div>

    <ul id="players-list"></ul>
  </div>

  <div id="timer-section">
    <h2>Game Timer</h2>
    <div id="timer-display">01:00:00</div>
    <div id="timer-controls">
      <button onclick="startTimer()">Start</button>
      <button onclick="pauseTimer()">Pause</button>
      <button onclick="resetTimer()">Reset</button>
    </div>
  </div>

  <div id="scoring-section" style="display:none;">
    <div id="current-player">
      <span id="selected-player-name"></span>
      <button id="unselect-btn" onclick="unselectPlayer()">Unselect</button>
    </div>
    <div id="go-button">
      <button class="game-btn" onclick="showGameAction('Go', 3)">Pass GO</button>
    </div>
    <!-- Categories (collapsible) -->
    <div class="category">
      <div class="category-header" onclick="toggleCategory(this)">Easy</div>
      <div class="category-content">
        <div class="game-buttons">
          <button class="game-btn" onclick="showGameAction('Jack n Poy', 1)">Jack 'n Poy</button>
          <button class="game-btn" onclick="showGameAction('Toss Coin', 1)">Toss Coin</button>
          <button class="game-btn" onclick="showGameAction('Uno', 1)">Uno</button>
        </div>
      </div>
    </div>

    <div class="category">
      <div class="category-header" onclick="toggleCategory(this)">Moderate</div>
      <div class="category-content">
        <div class="game-buttons">
          <button class="game-btn" onclick="showGameAction('Which One', [1,2,3])">Which One</button>
          <button class="game-btn" onclick="showGameAction('Get that Handkerchief!', 3)">Get that HKF</button>
          <button class="game-btn" onclick="showGameAction('Find the Pingpong ball', 3)">Find Pingpong</button>
        </div>
      </div>
    </div>

    <div class="category">
      <div class="category-header" onclick="toggleCategory(this)">Hard</div>
      <div class="category-content">
        <div class="game-buttons">
          <button class="game-btn" onclick="showGameAction('Bottle Flip', [3,6,9])">Bottle Flip</button>
          <button class="game-btn" onclick="showGameAction('Paper Cup Flip', [3,6,9])">Paper Cup Flip</button>
          <button class="game-btn" onclick="showGameAction('Don\'t Ring the Bell <br>Win = 5 : Lose = -3', [3,5])">Don't Ring Bell</button>
        </div>
      </div>
    </div>

    <div class="category">
      <div class="category-header" onclick="toggleCategory(this)">Very Hard</div>
      <div class="category-content">
        <div class="game-buttons">
          <button class="game-btn" onclick="showGameAction('Word Search', [1,2,3,4,10])">Word Search</button>
          <button class="game-btn" onclick="showGameAction('Ping Pong Ball<br>Win = 8 : Lose = -4', [4,8])">Ping Pong Ball</button>
          <button class="game-btn" onclick="showGameAction('Bridge Connect <br> Success = 10 : Fail = -5', [5,10])">Bridge Connect</button>
        </div>
      </div>
    </div>

    <!-- Manual Keypad Section -->
    <div id="manual-section">
      <h3>Manual Add/Subtract (or use keypad below)</h3>
      <div id="manual-input">
        <input type="number" id="manual-value" placeholder="Enter value" min="0">
      </div>

      <div id="manual-buttons">
        <button id="add-btn" onclick="applyManual(true)">+</button>
        <button id="subtract-btn" onclick="applyManual(false)">-</button>
      </div>

      <div class="keypad-container">
        <div class="keypad">
          <button onclick="appendToManual('1')">1</button>
          <button onclick="appendToManual('2')">2</button>
          <button onclick="appendToManual('3')">3</button>
          <button onclick="appendToManual('4')">4</button>
          <button onclick="appendToManual('5')">5</button>
          <button onclick="appendToManual('6')">6</button>
          <button onclick="appendToManual('7')">7</button>
          <button onclick="appendToManual('8')">8</button>
          <button onclick="appendToManual('9')">9</button>
          <button onclick="appendToManual('0')">0</button>
          <button onclick="clearManual()">C</button>
          <button onclick="applyManual(true, true)">+</button>
          <button onclick="applyManual(false, true)">-</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Action Modal -->
  <div id="game-modal" style="display: none;">
    <h3 id="modal-title"></h3>
    <p id="modal-desc"></p>
    <!-- Dynamic buttons will be inserted here by JS -->
  </div>
  <div id="overlay" style="display: none;" onclick="closeModal()"></div>

  <script>
    let players = []; 
    let selectedPlayerIndex = -1;
    let currentGameValue = 0;
    let currentGameName = '';

    function loadState() {
      try {
        const saved = localStorage.getItem('players');
        players = saved ? JSON.parse(saved) : [];
        const si = localStorage.getItem('selectedPlayerIndex');
        selectedPlayerIndex = (si !== null && !isNaN(parseInt(si, 10))) ? parseInt(si, 10) : -1;
      } catch {
        players = [];
        selectedPlayerIndex = -1;
      }
    }

    function saveState() {
      localStorage.setItem('players', JSON.stringify(players));
      localStorage.setItem('selectedPlayerIndex', String(selectedPlayerIndex));
    }

    function renderPlayers() {
      const list = document.getElementById('players-list');
      list.innerHTML = '';

      // sort players by score (descending), keep original index for selection
      const sortedPlayers = players
        .map((player, index) => ({ ...player, originalIndex: index }))
        .sort((a, b) => b.score - a.score);

      sortedPlayers.forEach((player) => {
        const li = document.createElement('li');

        // Create separate spans for name and score for better layout
        const nameSpan = document.createElement('span');
        nameSpan.className = 'player-name';
        nameSpan.textContent = player.name;
        nameSpan.onclick = (e) => {
          e.stopPropagation();
          selectPlayer(player.originalIndex);
        };

        const scoreSpan = document.createElement('span');
        scoreSpan.className = 'player-score';
        scoreSpan.textContent = `${player.score}`;

        // Delete button: Small X in top-right corner
        const delBtn = document.createElement('button');
        delBtn.textContent = "❌";
        delBtn.setAttribute('aria-label', 'Delete player');
        delBtn.className = 'delete-player-btn'; // For CSS styling
        delBtn.onclick = (e) => {
          e.stopPropagation();
          deletePlayer(player.originalIndex);
        };

        // Append elements to li
        li.appendChild(nameSpan);
        li.appendChild(scoreSpan);
        li.appendChild(delBtn);
        li.classList.toggle('selected', player.originalIndex === selectedPlayerIndex);
        li.onclick = () => selectPlayer(player.originalIndex); // Select on card click

        list.appendChild(li);
      });
    }

    function addPlayer() {
      const nameInput = document.getElementById('player-name');
      const name = nameInput.value.trim();
      if (!name) return;
      if (players.length >= 8) {
        alert('Maximum 8 players allowed.');
        return;
      }
      players.push({ name, score: 0 });
      nameInput.value = '';
      renderPlayers();
      saveState();
    }

    function selectPlayer(index) {
      if (!players[index]) return;
      selectedPlayerIndex = index;
      document.getElementById('scoring-section').style.display = 'block';
      document.getElementById('selected-player-name').textContent = `Selected: ${players[index].name}`;
      renderPlayers();
      saveState();
      document.querySelectorAll('.category-content').forEach(c => c.classList.remove('show'));
    }

    function unselectPlayer() {
      selectedPlayerIndex = -1;
      document.getElementById('scoring-section').style.display = 'none';
      document.getElementById('selected-player-name').textContent = '';
      renderPlayers();
      saveState();
    }

    function toggleCategory(header) {
      const content = header.nextElementSibling;
      content.classList.toggle('show');
    }

    function showGameAction(gameName, value) {
      currentGameName = gameName;

      let modal = document.getElementById('game-modal');
      let buttonsHTML = '';

      if (Array.isArray(value)) {
        // If multiple values are passed (like [1,2,3])
        value.forEach(v => {
          buttonsHTML += `
            <button onclick="applyCustomGameAction(true, ${v})" 
              style="background:#28a745;color:white;padding:10px 20px;margin:5px;border:none;border-radius:4px;cursor:pointer;">
              Add +${v}
            </button>
            <button onclick="applyCustomGameAction(false, ${v})" 
              style="background:#dc3545;color:white;padding:10px 20px;margin:5px;border:none;border-radius:4px;cursor:pointer;">
              Subtract -${v}
            </button><br>
          `;
        });
      } else {
        // Fallback for single-value games
        currentGameValue = value;
        buttonsHTML = `
          <button onclick="applyCustomGameAction(true, ${value})" 
            style="background:#28a745;color:white;padding:10px 20px;margin:5px;border:none;border-radius:4px;cursor:pointer;">
            Add +${value}
          </button>
          <button onclick="applyCustomGameAction(false, ${value})" 
            style="background:#dc3545;color:white;padding:10px 20px;margin:5px;border:none;border-radius:4px;cursor:pointer;">
            Subtract -${value}
          </button>
        `;
      }

      modal.innerHTML = `
        <h3>${gameName}</h3>
        <p>Choose a point value to add or subtract:</p>
        ${buttonsHTML}
        <button onclick="closeModal()" 
          style="background:#6c757d;color:white;padding:10px 20px;margin:5px;border:none;border-radius:4px;cursor:pointer;">
          Cancel
        </button>
      `;

      modal.style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function applyCustomGameAction(add, value) {
      if (selectedPlayerIndex === -1) return;
      players[selectedPlayerIndex].score += add ? value : -value;
      closeModal();
      renderPlayers();
      saveState();
    }

    function applyGameAction(add) {
      if (selectedPlayerIndex === -1) return;
      const delta = add ? currentGameValue : -currentGameValue;
      players[selectedPlayerIndex].score += delta;
      closeModal();
      renderPlayers();
      saveState();
    }

    function closeModal() {
      document.getElementById('game-modal').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function applyManual(add, fromKeypad = false) {
      if (selectedPlayerIndex === -1) return;
      const input = document.getElementById('manual-value');
      let value = parseInt(input.value, 10);
      if (isNaN(value)) value = fromKeypad ? 1 : 0;
      if (value === 0 && !fromKeypad) return;
      const delta = add ? value : -value;
      players[selectedPlayerIndex].score += delta;
      input.value = '';
      renderPlayers();
      saveState();
    }

    function appendToManual(digit) {
      const input = document.getElementById('manual-value');
      input.value = (input.value || '') + digit;
    }

    function clearManual() {
      document.getElementById('manual-value').value = '';
    }

    function deletePlayer(index) {
      if (index < 0 || index >= players.length) return;
      players.splice(index, 1);
      if (selectedPlayerIndex === index) {
        selectedPlayerIndex = -1;
        document.getElementById('scoring-section').style.display = 'none';
        document.getElementById('selected-player-name').textContent = '';
      } else if (selectedPlayerIndex > index) {
        selectedPlayerIndex -= 1;
      }
      renderPlayers();
      saveState();
    }

    function deleteAllPlayers() {
      if (!confirm('Are you sure you want to delete all players?')) return;
      players = [];
      selectedPlayerIndex = -1;
      renderPlayers();
      saveState();
      document.getElementById('scoring-section').style.display = 'none';
      document.getElementById('selected-player-name').textContent = '';
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadState();
      renderPlayers();

      if (selectedPlayerIndex !== -1 && players[selectedPlayerIndex]) {
        document.getElementById('scoring-section').style.display = 'block';
        document.getElementById('selected-player-name').textContent = `Selected: ${players[selectedPlayerIndex].name}`;
      } else {
        selectedPlayerIndex = -1;
        saveState();
      }
    });

    // Timer functions (unchanged)
    let timerInterval;
    let timeRemaining = 3600; // default: 1 hour in seconds
    let isRunning = false;
    let endTime = null; // store absolute end time (Date.now() + remaining ms)

// Update the visible timer
function updateTimerDisplay() {
  const hours = String(Math.floor(timeRemaining / 3600)).padStart(2, '0');
  const minutes = String(Math.floor((timeRemaining % 3600) / 60)).padStart(2, '0');
  const seconds = String(timeRemaining % 60).padStart(2, '0');
  document.getElementById('timer-display').textContent = `${hours}:${minutes}:${seconds}`;
}

// Save timer state to localStorage
function saveTimerState() {
  localStorage.setItem('timerState', JSON.stringify({
    timeRemaining,
    isRunning,
    endTime
  }));
}

// Load timer state on page refresh
function loadTimerState() {
  const saved = localStorage.getItem('timerState');
  if (!saved) return;

  const state = JSON.parse(saved);
  timeRemaining = state.timeRemaining;
  isRunning = state.isRunning;
  endTime = state.endTime;

  if (isRunning && endTime) {
    // Recalculate remaining time
    const now = Date.now();
    timeRemaining = Math.max(0, Math.floor((endTime - now) / 1000));
    if (timeRemaining > 0) {
      startTimer(true); // resume automatically
    } else {
      timeRemaining = 0;
      isRunning = false;
    }
  }
  updateTimerDisplay();
}

function startTimer(resume = false) {
  if (isRunning && !resume) return; // don’t restart if already running
  isRunning = true;
  if (!resume) {
    endTime = Date.now() + timeRemaining * 1000; // set new end time
  }
  saveTimerState();

  timerInterval = setInterval(() => {
    const now = Date.now();
    timeRemaining = Math.max(0, Math.floor((endTime - now) / 1000));
    updateTimerDisplay();
    saveTimerState();

    if (timeRemaining <= 0) {
      clearInterval(timerInterval);
      isRunning = false;
      saveTimerState();
      alert("⏰ Time’s up!");
    }
  }, 1000);
}

function pauseTimer() {
  clearInterval(timerInterval);
  isRunning = false;
  endTime = null; // clear end time
  saveTimerState();
}

function resetTimer() {
  clearInterval(timerInterval);
  timeRemaining = 3600; // reset to 1 hour
  isRunning = false;
  endTime = null;
  updateTimerDisplay();
  saveTimerState();
}

// Initialize on page load
window.addEventListener('DOMContentLoaded', () => {
  loadTimerState();
  updateTimerDisplay();
});

  </script>
</body>
</html>

